<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>About</title>
    <meta name="People and Economic" content="Qiuyu li" />
    <meta name="description" content="People and Economic Page" />
    <meta name="keywords" content="fullpage,jquery,demo,screen,fixed,fullscreen,backgrounds,full-screen" />
    <meta name="Resource-type" content="Document" />
    <link rel="stylesheet" href="css/index_style.css" />
    <link rel="stylesheet" type="text/css" href="css/fullpage.css" />
    <link rel="stylesheet" type="text/css" href="css/examples.css" />
    <style>


        /* Style for our header texts
        * --------------------------------------- */
        h1 {
            font-size: 5em;
            font-family: 'Oswald', sans-serif;
            margin: 0;
            padding: 0;
            color: #fff
        }

            h1.logo {
                font-size: 2em;
            }

        p {
            font-size: 1.5em;
            font-family: 'Open Sans', sans-serif;
            color: #fff;
            margin: 0;
            padding: 0;
        }
    
        /* background for body
        * --------------------------------------- */
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url("/CASA0003_Visualisation_Group_7/Website/img/Page_people.jpg") fixed center center;
            padding: 6% 0 0 0;
            background-size: cover;
            background-attachment: fixed;
        }
    </style>
    <!--[if IE]>
        <script type="text/javascript">
             var console = { log: function() {} };
        </script>
    <![endif]-->

    <style>
        .frame {
            fill: none;
            stroke: #000;
        }

        .axis text {
            font: 14px sans-serif;
        }

        .axis line,
        .axis circle {
            fill: none;
            stroke: #ddd;
            /*stroke-dasharray: 4;*/
        }

        .axis:last-of-type circle {
            stroke: steelblue;
            stroke-dasharray: none;
        }

        .line {
            fill: none;
            stroke: orange;
            stroke-width: 3px;
        }

        #chart {
            text-align: center;
        }

        .chart-title {
            text-align: center;
        }

        .tooltip {
            font: bold 25px Verdana;
            /*font-family: simsun;*/
            font-size: 12px;
            width: 120px;
            height: auto;
            color: #555;
            position: absolute;
            text-align: left;
            border-style: solid;
            border-width: 2px;
            background-color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="main" style="background-color:transparent;">
        <header>
            <h1 class="logo" style="color:#fff;"> SHH </h1>
        </header>
    </div>
    <div id="fullpage2">
        <div>
            <h1 style="width: 70%; line-height: 200px; margin:0 auto; color:rgb(255, 1, 1);text-align: center;">
                人和经济的具体内容
            </h1>
            <p style="width:80%;  margin:0 auto;text-indent:2em; ">
                HTML的英文全称是 Hyper Text Markup Language，即超文本标记语言。HTML是由Web的发明者 Tim Berners-Lee和同事 Daniel W. Connolly于1990年创立的一种标记语言，它是标准通用化标记语言SGML的应用。用HTML编写的超文本文档称为HTML文档，它能独立于各种操作系统平台(如UNIX， Windows等)。使用HTML，将所需要表达的信息按某种规则写成HTML文件，通过专用的浏览器来识别，并将这些HTML文件“翻译”成可以识别的信息，即现在所见到的网页。 [2]
                自1990年以来，HTML就一直被用作万维网的信息表示语言，使用HTML描述的文件需要通过web浏览器显示出效果。HTML是一种建立网页文件的语言，通过标记式的指令(Tag)，将影像、声音、图片、文字动画、影视等内容显示出来。事实上，每一个HTML文档都是一种静态的网页文件，这个文件里面包含了HTML指令代码，这些指令代码并不是一种程序语言，只是一种排版网页中资料显示位置的标记结构语言，易学易懂，非常简单。HTML的普遍应用就是带来了超文本的技术―通过单击鼠标从一个主题跳转到另一个主题，从一个页面跳转到另一个页面，与世界各地主机的文件链接超文本传输协议规定了浏览器在运行HTML文档时所遵循的规则和进行的操作。HTTP的制定使浏览器在运行超文本时有了统一的规则和标准。 [2]
                万维网（world wide web，简称www）上的一个超媒体文档称之为一个页面（外语：page）。作为一个组织或者个人在万维网上放置开始点的页面称为主页（外语：Homepage）或首页，主页中通常包括有指向其他相关页面或其他节点的指针（超级链接），所谓超级链接，就是一种统一资源定位器（Uniform Resource Locator，外语缩写：URL）指针，通过激活（点击）它，可使浏览器方便地获取新的网页。这也是HTML获得广泛应用的最重要的原因之一。在逻辑上将视为一个整体的一系列页面的有机集合称为网站（Website或Site）。超文本标记语言（英文缩写：HTML）是为“网页创建和其它可在网页浏览器中看到的信息”设计的一种标记语言。 [3]
                网页的本质就是超文本标记语言，通过结合使用其他的Web技术（如：脚本语言、公共网关接口、组件等），可以创造出功能强大的网页。因而，超文本标记语言是万维网（Web）编程的基础，也就是说万维网是建立在超文本基础之上的。超文本标记语言之所以称为超文本标记语言，是因为文本中包含了所谓“超级链接”点。 [4]
                定义
                超文本标记语言是标准通用标记语言下的一个应用，也是一种规范，一种标准，它通过标记符号来标记要显示的网页中的各个部分。网页文件本身是一种文本文件，通过在文本文件中添加标记符，可以告诉浏览器如何显示其中的内容（如：文字如何处理，画面如何安排，图片如何显示等）。浏览器按顺序阅读网页文件，然后根据标记符解释和显示其标记的内容，对书写出错的标记将不指出其错误，且不停止其解释执行过程，编制者只能通过显示效果来分析出错原因和出错部位。但需要注意的是，对于不同的浏览器，对同一标记符可能会有不完全相同的解释，因而可能会有不同的显示效果。 [3]
                HTML版本编辑
                HTML是用来标记Web信息如何展示以及其他特性的一种语法规则，它最初于1989年由CERN的Tim Berners-Lee发明。HTML基于更古老一些的语言SGML定义，并简化了其中的语言元素。这些元素用于告诉浏览器如何在用户的屏幕上展示数据，所以很早就得到各个Web浏览器厂商的支持。 [5]
                HTML历史上有如下版本： [5]
                ①HTML 1.0：在1993年6月作为互联网工程工作小组(IETF)工作草案发布。 [5]
                ②HTML 2.0：1995年1 1月作为RFC 1866发布，于2000年6月发布之后被宣布已经过时。 [5]
                ③HTML 3.2：1997年1月14日，W3C推荐标准。 [5]
                ④HTML 4.0：1997年12月18日，W3C推荐标准。 [5]
                ⑤HTML 4.01（微小改进）：1999年12月24日，W3C推荐标准。 [5]
                ⑥HTML 5：HTML5是公认的下一代Web语言，极大地提升了Web在富媒体、富内容和富应用等方面的能力，被喻为终将改变移动互联网的重要推手。Internet Explorer 8及以前的版本不支持。 [6]
                HTML在Web迅猛发展的过程中起着重要作用，有着重要的地位。但随着网络应用的深入，特别是电子商务的应用，HTML过于简单的缺陷很快凸现出来：HTML不可扩展。HTML不允许应用程序开发者为具体的应用环境定义自定义的标记。HTML只能用于信息显示。HTML可以设置文本和图片显示方式，但没有语义结构，即HTML显示数据是按照布局而非语义的。随着网络应用的发展，各行业对信息有着不同的需求，这些不同类型的信息未必都是以网页的形式显示出来。例如。当通过搜索引擎进行数据搜索时，按照语义而非按照布局来显示数据会具有更多的优点。
                总而言之，HTML的缺点使其交互性差，语义模糊，这些缺陷难以适应Internet飞速发展的要求，因此一个标准、简洁、结构严谨以及可高度扩展的XML就产生了。
            </p>
        </div>
        <div id="chart">
            <h2 class="chart-title">title</h2>
        </div>
    </div>
    <div class="menu">
        <ul>
            <li><a href="landmark.html">Landmark</a></li>
            <li><a href="transportation.html">Transportation</a></li>
            <li class="active"><a href="people&economic.html">People and Economic</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="index.html">Home</a></li>
        </ul>
    </div>
    <div class="main" style="background-color:transparent;position:relative;min-height:100px;">
        <footer>
            <!-- 向下滚动 -->
            <div id="explore">
                <b> Explore next part</b>
            </div>

            <a href="/transportation.html">
                <div class="scroll-down"></div>
            </a>
        </footer>
 
    <script src="js/d3.v5.min.js"></script>
    <script>
        var width = 960,
            height = 600,
            radius = Math.min(width, height) / 2 - 100;
        var maxAngle = 24;
        var maxValue = 0;
        var currentYear = "1996";
        var minValue = 800;
        var yearList = [
            2005, 2006, 2007, 2009, 2010, 2011, 2012, 2013, 2014
        ];
        var yearIndex = 0;

        var datalist = [];

        var svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        // 定义弹出提示框，鼠标mouseover时用于显示相关消息
        var tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0.0);

        // 生成弹出提示框的内容
        function tooltipContent(list, title) {
            var tpl = "<div style='margin-top:5px;'><span>"
            tpl += "{name}: </span>{value}</div>";
            var html = "<div style='padding-left:20px;padding-right: 20px;padding-bottom:10px;font-size:12px;'>";
            html += "<h2>" + title + "</h2>"
            list.forEach(function (dataItem) {
                name = dataItem.name, value = dataItem.value;
                html += tpl.replace("{name}", name).replace("{value}", value);
            });
            html += "</div>";
            return html;
        }

        function draw() {
            var data = datalist[0];
            var weekName = "week"
            var valueName = "count";
            maxValue += minValue;

            // 枚举每周七天的星期
            var weeks = [
                "Monday",
                "6AM",
                "12PM",
                "6PM",
                "Tuesday",
                "6AM",
                "12PM",
                "6PM",
                "Wednesday",
                "6AM",
                "12PM",
                "6PM",
                "Thursday",
                "6AM",
                "12PM",
                "6PM",
                "Friday",
                "6AM",
                "12PM",
                "6PM",
                "Saturday",
                "6AM",
                "12PM",
                "6PM",
                "Sunday",
                "6AM",
                "12PM",
                "6PM"
            ];
            var maxAxisScale = 7 * 24 * 60;

            var axisScale = d3.scaleLinear()
                .domain([0, maxAxisScale])
                .range([0, 2 * Math.PI]);

            var r = d3.scaleLinear()
                .domain([0, maxValue])
                .range([0, radius]);

            var computeColor = d3.interpolate(
                d3.rgb(144, 212, 190),
                d3.rgb(38, 135, 188))
                ;
            var colorLinear = d3.scaleLinear()
                .domain([0, maxValue])
                .range([0, 1])
                ;
            var color = function (value) {
                return computeColor(colorLinear(value));
            };

            var ga = svg.append("g")
                .attr("class", "a axis")
                .selectAll("g")
                .data(weeks)
                .enter()
                .append("g")
                .attr("transform", function (d, i) {
                    return "rotate(" + (axisScale(i * maxAxisScale / weeks.length) * 180 / Math.PI) + ")";
                });

            ga.append("line")
                .attr("state", d => d)
                .attr("x2", radius);

            ga.append("text")
                .attr("x", radius + 6)
                .attr("dy", ".35em")
                .style("text-anchor", function (d) { return d < 270 && d > 90 ? "end" : null; })
                .attr("transform", function (d) {
                    return d < 270 && d > 90 ? "rotate(180 " + (radius + 6) + ",0)" : null;
                })
                .style("fill", (d, i) => {
                    if (i % 4 === 0) {
                        return "black"
                    }
                    return "#aaa";
                })
                .text(function (d, i) { return d; });

            //var color = d3.scaleOrdinal(d3.schemeCategory10);
            var line = d3.lineRadial()
                .angle(function (d) {
                    return axisScale(d[0]) + Math.PI / 2;
                })
                .radius(function (d) {
                    return r(d[1]);
                });

            for (var index = 0; index < datalist.length; index++) {
                // 生成圆圈的数据
                var dataValues = [];
                datalist[index].forEach(function (item, i) {
                    var violent = item[valueName];
                    dataValues.push([
                        i * 15,
                        violent + minValue / datalist.length * (index + 1),
                        item[weekName],
                        yearList[index],
                        item.time,
                        violent
                    ]);
                });
                dataValues.push(dataValues[0]);

                // 绘制圆圈
                svg.selectAll(".area-" + index)
                    .data([dataValues])
                    .enter()
                    .append("polygon")
                    .attr("class", "area-" + index)
                    .style("stroke-width", "1px")
                    .style("stroke", color(minValue / datalist.length * (index + 1)))
                    .attr("points", function (d) {
                        var str = "";
                        for (var pti = 0; pti < d.length; pti++) {
                            var coors = line([d[pti]])
                                .slice(1)
                                .slice(0, -1);
                            str = str + coors + " ";
                        }
                        return str;
                    })
                    .style("fill", "none")
                    .on("mouseover", function (d, i) {
                        d3.select(this)
                            .style("stroke-width", "3px");
                    })
                    .on("mouseout", function () {
                        d3.select(this)
                            .style("stroke-width", "1px");
                    });

                // 绘制散点
                svg.selectAll(".circle-" + index)
                    .data(dataValues)
                    .enter()
                    .append("circle")
                    .attr("class", "circle-" + index)
                    .style("stroke-width", "1px")
                    .style("stroke", color(minValue / datalist.length * (index + 1)))
                    .attr("cx", function (d) {
                        var coors = line([d])
                            .slice(1)
                            .slice(0, -1);
                        var arr = coors.split(",");
                        return arr[0];
                    })
                    .attr("cy", function (d) {
                        var coors = line([d])
                            .slice(1)
                            .slice(0, -1);
                        var arr = coors.split(",");
                        return arr[1];
                    })
                    .attr("r", 0.5)
                    .style("fill", "none")
                    .on("mouseover", function (d, i) {
                        // 生成信息框消息内容
                        var strhtml = tooltipContent([
                            { name: "count", value: d[5] },
                            { name: "week", value: d[2] },
                            { name: "time", value: d[4] }
                        ], d[3]);

                        // 弹出信息框
                        tooltip.html(strhtml)
                            .style("width", "auto")
                            .style("height", "auto")
                            .style("left", (event.pageX - 60) + "px")
                            .style("top", (event.pageY + 20) + "px")
                            .style("opacity", 1.0)
                            ;
                        d3.select(this)
                            .style("stroke-width", "3px");
                    })
                    .on("mouseout", function () {
                        // 隐藏信息框
                        tooltip.style("width", 0)
                            .style("height", 0)
                            .style("opacity", 0.0);
                        d3.select(this)
                            .style("stroke-width", "1px");
                    });
            }
        }

        function RequsetData() {
            if (yearIndex >= yearList.length) {
                draw();
                return;
            }
            d3.csv("data/"+yearList[yearIndex] + ".csv?v=1").then(function (data) {
                var weekName = "week"
                var valueName = "count";

                var currentWeek = "";
                data.forEach(function (item) {
                    if (item[weekName] !== "") {
                        currentWeek = item[weekName];
                    }
                    item[weekName] = currentWeek;
                    item[valueName] = item[valueName] * 1;
                    maxValue = Math.max(maxValue, item[valueName]);
                });
                datalist.push(data);
                yearIndex++;
                RequsetData();
            });
        }
        RequsetData();
    </script>
</body>
</html>
